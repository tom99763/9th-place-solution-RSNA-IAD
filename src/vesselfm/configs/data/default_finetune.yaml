sample_prop: 1.0
fold_idx: 0
file_format: "nii"
image_size: ${input_size}
filter_dataset_IDs: null
transforms:
  train:
    - EnsureChannelFirstd:
        keys: ["Image", "Mask"]
        channel_dim: "no_channel"
    - EnsureTyped:
        keys: ["Image", "Mask"]
    - Resized:                        # ðŸ”¹ resize before cropping
        keys: ["Image", "Mask"]
        spatial_size: ${vol_size}  # e.g. [128, 128, 128]
        mode: ["trilinear", "nearest"]  # image â†’ trilinear, mask â†’ nearest
    - RandCropByPosNegLabeld:
        keys: [ "Image", "Mask" ]
        label_key: "Mask"
        spatial_size: ${input_size}   # same as before
        pos: 4                        # number of foreground patches per sample
        neg: 0                        # number of background patches per sample
        num_samples: 4                # total number of crops per volume
        image_key: "Image"
        allow_smaller: True
    - RandFlipd:
        keys: ["Image", "Mask"]
        spatial_axis: [0]        # flip along z-axis (depth)
        prob: 0.5
    - RandFlipd:
        keys: ["Image", "Mask"]
        spatial_axis: [1]        # flip along y-axis
        prob: 0.5
    - RandFlipd:
        keys: ["Image", "Mask"]
        spatial_axis: [2]        # flip along x-axis
        prob: 0.5
    - ScaleIntensityd:
        keys: ["Image"]
        minv: 0
        maxv: 1
    - SpatialPadd:
        keys: ["Image", "Mask"]
        spatial_size: ${input_size}
        mode: "constant"
        method: "symmetric"
    - ConcatItemsd:
        keys: ["Image", "Mask"]
        name: ["Image", "Mask"]
        dim: 0
    - ToTensord:
        keys: ["Image", "Mask"]

  val:
    - EnsureChannelFirstd:
        keys: ["Image", "Mask"]
        channel_dim: "no_channel"
    - EnsureTyped:
        keys: ["Image", "Mask"]
    - Resized:                        # ðŸ”¹ add resize for validation
        keys: ["Image", "Mask"]
        spatial_size: ${vol_size}
        mode: ["trilinear", "nearest"]
    - ScaleIntensityRangePercentilesd:
        keys: ["Image"]
        lower: 2
        upper: 98
        b_min: 0
        b_max: 1
    - ToTensord:
        keys: ["Image", "Mask"]

  test:
    - EnsureChannelFirstd:
        keys: ["Image", "Mask"]
        channel_dim: "no_channel"
    - EnsureTyped:
        keys: ["Image", "Mask"]
    - Resized:                        # ðŸ”¹ add resize for test
        keys: ["Image", "Mask"]
        spatial_size: ${vol_size}
        mode: ["trilinear", "nearest"]
    - ScaleIntensityRangePercentilesd:
        keys: ["Image"]
        lower: 1
        upper: 99
        b_min: 0
        b_max: 1
    - ToTensord:
        keys: ["Image", "Mask"]